@page "/"
@using DX.Data;
@using DX.Shared;
@using Newtonsoft.Json.Linq
@inject WeatherForecastService svc
@inject IJSRuntime JSRuntime

<link rel="stylesheet" href="@urlTheme" />


<RadzenProgressBar Value="1500" ShowValue="false" ProgressBarStyle="ProgressBarStyle.Light" Mode="ProgressBarMode.Indeterminate" Visible="@IsLoading" />
<RadzenSplitter Orientation="Radzen.Orientation.Horizontal" Collapse=@OnCollapse Expand=@OnExpand style="height: max-content; border: 0px solid rgba(0,0,0,.08);">


    <link rel="stylesheet" href="@urlTheme" />
    <RadzenSplitterPane Size="30%" Min="10px">
        <div hidden="@hideRekapitulasi">
            <DxGrid Data="@_dsRekapitulasi"
                PageSize="1000"
                CssClass="ch-360">
                <Columns>
                    <DxGridDataColumn FieldName="TemperatureC" Caption="@("Temp. (\x2103)")"/>
                    <DxGridDataColumn FieldName="TemperatureF" Caption="@("Temp. (\x2109)")"/>
                    <DxGridDataColumn FieldName="Summary" Caption="Summary" />
                </Columns>
            </DxGrid>
        </div>
        <div hidden="@hideKonfigurasi" class="konfigurasi">
                <div>
                    <span style="font-size:small; color:gray">Pengaturan Form</span>
                <DxFormLayout>

                    <DxFormLayoutGroup Caption="Personal Information" ColSpanMd="12">
                        <DxFormLayoutItem Caption="Tema" ColSpanMd="12">
                            <DxComboBox Text="Tema" Data="@ListThemes"
                                        SelectedItemChanged="@((ModelTheme modelTheme) => OnItemClick(modelTheme))"
                                        DropDownCssClass="image purple"
                                        Value="Value">
                                <DxListEditorColumn FieldName="@nameof(ModelTheme.Parent)"
                                                    Caption="Sumber" />
                                <DxListEditorColumn FieldName="@nameof(ModelTheme.Theme)"
                                                    Caption="Tema" />
                            </DxComboBox>
                        </DxFormLayoutItem>
                        <DxFormLayoutItem Caption="Font Size:" ColSpanMd="12">
                            <DxTextBox @bind-Text="@Value" />
                        </DxFormLayoutItem>
                    </DxFormLayoutGroup>
                </DxFormLayout>
                </div>
                <br/><br/><br/>
                <div>
                    <span style="font-size:small; color:gray">Pengaturan Cetak</span>
                <DxGrid Data="@ListDokumen"
                        PageSize="30">
                        <Columns>
                        <DxGridDataColumn FieldName="Dokumen" Caption="Dokumen" />
                            <DxGridDataColumn  Caption="P">
                                <CellDisplayTemplate>
                                    <DxCheckBox Checked="false"></DxCheckBox>
                                </CellDisplayTemplate>
                             </DxGridDataColumn>
                             <DxGridDataColumn Caption="Output">

                             </DxGridDataColumn>
                            <DxGridDataColumn  Caption="J">
                                <CellDisplayTemplate>
                                    <DxSpinEdit MinValue="0" MaxValue="10"></DxSpinEdit>
                                </CellDisplayTemplate>
                             </DxGridDataColumn>
                        </Columns>
                    </DxGrid>
                </div>
        </div>
        <div class="card navigasi-rekapitulasi">
              <div class="card-body" style="align-items:end">
                <button type="button" class="btn btn-default @isRekapitulasiAktif" @onclick="TampilRekapitulasi" data-toggle="tooltip" data-placement="top" title="Rekapitulasi" aria-label="Left Align">
                         <span class="fa fa-regular fa-file-lines" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn btn-default @isSettingAktif"  @onclick="TampilKonfigurasi" data-toggle="tooltip" data-placement="top" title="Settings" aria-label="Left Align">
                         <span class="fa fa-solid fa-gear" aria-hidden="true"></span>
                </button>
              </div>
        </div>   
    </RadzenSplitterPane>
    <RadzenSplitterPane Style="height:80vh">
        <h5 style="padding:5px;">Test</h5>
    </RadzenSplitterPane>

    
</RadzenSplitter>
<style>
    .parent {
        position: relative;
    }

    .bottom {
        position: absolute; /* Set div position to relative */
        width:100%;
    }
    .navigasi-rekapitulasi {
        position: sticky; /* Set div position to relative */
        width:100%;
        align-items:end;
    }
    .ch-360 {
        height: 70vh;
    }

    .konfigurasi{
        height: 70vh;
    }

    @@media only screen and (max-width: 768px) {
        .dxbs-grid{
           height: 60vh !important;
        }

        .konfigurasi{
            height:60vh !important;
        }
    }

    @@media only screen and (max-width: 992px) {
        .dxbs-grid{
           height: 65vh !important;
        }

        .konfigurasi{
            height:65vh !important;
        }
    }
    /*@@media(min-width:768px){
        .dxbs-grid{
           height: 65vh !important;
        }
        .konfigurasi{
            height:65vh !important;
        }
    }*/
</style>
@code {
    ModelTheme modelTheme = new();
    public string urlTheme { get; set; } = "css/bootstrap/bootstrap.min.css";
    [Parameter] public bool Visible { get; set; }
    [Parameter] public EventCallback<bool> VisibleChanged { get; set; }
    [Parameter] public EventCallback<ThemeItem> ActiveThemeChanged { get; set; }
    public string Value{ get; set; }
    string isRekapitulasiAktif = "btn-secondary";
    string isSettingAktif = "";
    bool hideRekapitulasi = false;
    bool hideKonfigurasi = true;
    IGrid Grid { get; set; }
    public bool IsLoading { get; set; }
    private int fontSize = 12;
    private List<WeatherForecast> _dsRekapitulasi { get; set; } = new();
    private List<Konfigurasi> _konfigurasi { get; set; } = new();
    private List<ModelDokumen> _cetak { get; set; } = new();

    public List<ModelTheme> ListThemes { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {

        foreach (var Themeitems in modVariabel.GroupedThemes)
        {
            string parent = Themeitems.Key.ToString();
            foreach (var item in Themeitems.Value)
            {
                var data = new ModelTheme { Parent = parent, Theme = item };
                ListThemes.Add(data);
            }
        }

        _dsRekapitulasi.AddRange(await svc.GetForecastAsync(DateTime.Now));
        _konfigurasi.Add(new Konfigurasi
            {
                Nama = "Skin Name",
                Value = 0,
            });
        _konfigurasi.Add(new Konfigurasi
            {
                Nama = "Increase Font Size",
                Value = 1,
            });
        var doc = canCetak.Split('|').ToList();
        foreach (var item in doc)
        {
            ListDokumen.Add(new ModelDokumen { Dokumen = item });
        }
    }
    public async Task OnItemClick(ModelTheme? theme=null)
    {
        if (theme != null)
        {
            if (modVariabel._activeTheme.Name != theme.Theme && theme != null)
            {
                var themeItem = ThemeItem.Create(theme.Theme);
                if (themeItem.StylesheetLinkUrl[1] is not null)
                {
                    urlTheme = themeItem.StylesheetLinkUrl[1];
                }
                foreach (string stylesheetLinkUrl in themeItem.StylesheetLinkUrl)
                    await JSRuntime.InvokeVoidAsync("fetch", stylesheetLinkUrl, new
                    {
                        method = "GET",
                        mode = "no-cors"
                    });
                await Task.WhenAll(
                    ActiveThemeChanged.InvokeAsync(themeItem),
                    VisibleChanged.InvokeAsync(false)
                );
            }
        }


        StateHasChanged();
    }

    void TampilRekapitulasi()
    {
        isSettingAktif = "";
        isRekapitulasiAktif = "btn-secondary";
        hideRekapitulasi = false;
        hideKonfigurasi = true;

    }

    void TampilKonfigurasi()
    {
        isSettingAktif = "btn-secondary";
        isRekapitulasiAktif = "";
        hideRekapitulasi = true;
        hideKonfigurasi = false;
    }

    void UbahFontSize(int size)
    {

    }
    void OnCollapse(RadzenSplitterEventArgs args)
    {
    }
    void OnExpand(RadzenSplitterEventArgs args)
    {
    }

    public class Konfigurasi
    {
        public string Nama { get; set; }
        public int Value { get; set; }
    }

    public class ModelDokumen
    {
        public string Dokumen { get; set; }
    }

    public class ModelTheme
    {
        public string Parent { get; set; }
        public string Theme { get; set; }
    }

    string canCetak { get; set; } = "Rekapitulasi|Invoice|Barcode";

    List<ModelDokumen> ListDokumen { get; set; } = new();

}